**WARNING**: I haven't actually tested the generated code yet!!!
